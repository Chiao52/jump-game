<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>北宋山水行旅 - 瑪利歐模式</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #202020;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            overflow: hidden;
        }
        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        canvas {
            background-color: #e0d5c1; /* 仿古紙色 */
            display: block;
        }
        #ui-layer {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #333;
            font-size: 18px;
            font-weight: bold;
            pointer-events: none;
        }
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border: 2px solid #5a3d31;
            text-align: center;
            display: none;
        }
        .controls {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="ui-layer">
        <div>當前區域: <span id="zone-name">起點</span></div>
        <div>分數: <span id="score">0</span></div>
        <div style="font-size: 14px; margin-top:5px; color:#555;">尋找畫中隱藏的秘密...</div>
    </div>
    <div id="message">
        <h2 id="msg-title">準備開始</h2>
        <p id="msg-text">穿越北宋三大家的畫作世界。<br>小心「蟹爪枝」與「斧劈皴」！</p>
        <button onclick="startGame()">開始旅程</button>
        <div class="controls">← → 移動 | 空白鍵 跳躍</div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const uiZone = document.getElementById('zone-name');
    const uiScore = document.getElementById('score');
    const msgBox = document.getElementById('message');
    
    // 遊戲狀態
    let gameState = 'MENU'; // MENU, PLAYING, GAMEOVER, WIN
    let score = 0;
    let frameCount = 0;

    // 玩家設定
    const player = {
        x: 50,
        y: 400,
        width: 30,
        height: 40,
        vx: 0,
        vy: 0,
        speed: 5,
        jumpPower: -12,
        gravity: 0.6,
        grounded: false,
        color: '#d93a3a' // 類似印泥的紅色
    };

    // 輸入控制
    const keys = {
        left: false,
        right: false,
        up: false
    };

    // 關卡數據 (結合 PDF 內容)
    // 0 = 空氣, 1 = 地面, 2 = 范寬隱藏簽名磚, 3 = 蟹爪枝(尖刺), 4 = 斧劈皴(岩石), 5 = 終點, 6 = 驢隊(敵人)
    // 每個區塊寬 800px，共三個區塊
    let platforms = [];
    let enemies = [];
    let particles = [];
    let cameraX = 0;
    
    // 根據 PDF 內容生成的關卡區域說明
    const zones = [
        { name: "范寬 - 谿山行旅", start: 0, end: 1200, desc: "巍峨主山，雨點皴。尋找樹蔭下的簽名。" },
        { name: "郭熙 - 早春圖", start: 1200, end: 2400, desc: "S形山石，卷雲皴。小心蟹爪枝。" },
        { name: "李唐 - 萬壑松風", start: 2400, end: 3600, desc: "斧劈皴，青綠設色。岩面堅硬。" }
    ];

    function initLevel() {
        platforms = [];
        enemies = [];
        score = 0;
        player.x = 50;
        player.y = 400;
        player.vx = 0;
        player.vy = 0;
        cameraX = 0;

        // --- Zone 1: 范寬 (0 - 1200) ---
        // 地面
        platforms.push({x: 0, y: 550, w: 1200, h: 50, type: 'ground', style: 'fankuan'});
        // 巨石 (巨碑式構圖)
        platforms.push({x: 300, y: 450, w: 100, h: 100, type: 'block', style: 'fankuan'});
        platforms.push({x: 500, y: 350, w: 150, h: 200, type: 'block', style: 'fankuan'});
        // 隱藏要素：樹蔭下的「范寬」二字 (PDF提到)
        platforms.push({x: 550, y: 200, w: 40, h: 40, type: 'secret', hit: false}); 
        // 驢隊 (PDF提到：路側車馬紆行，驢隊)
        enemies.push({x: 700, y: 520, w: 40, h: 30, type: 'donkey', speed: -2, patrol: {min: 600, max: 900}});

        // --- Zone 2: 郭熙 (1200 - 2400) ---
        // 間隙 (深淵)
        platforms.push({x: 1300, y: 550, w: 1100, h: 50, type: 'ground', style: 'guoxi'});
        // S型山石 與 卷雲皴平台
        platforms.push({x: 1400, y: 400, w: 100, h: 20, type: 'cloud', style: 'guoxi'});
        platforms.push({x: 1600, y: 300, w: 100, h: 20, type: 'cloud', style: 'guoxi'});
        platforms.push({x: 1800, y: 450, w: 100, h: 20, type: 'cloud', style: 'guoxi'});
        // 蟹爪枝 (尖刺障礙，PDF提到)
        platforms.push({x: 1500, y: 520, w: 40, h: 30, type: 'spike', style: 'crabclaw'});
        platforms.push({x: 1900, y: 520, w: 40, h: 30, type: 'spike', style: 'crabclaw'});
        
        // --- Zone 3: 李唐 (2400 - 3600) ---
        platforms.push({x: 2400, y: 550, w: 1500, h: 50, type: 'ground', style: 'litang'});
        // 斧劈皴 (尖銳岩石)
        platforms.push({x: 2600, y: 450, w: 60, h: 100, type: 'block', style: 'axe'});
        platforms.push({x: 2750, y: 350, w: 60, h: 200, type: 'block', style: 'axe'});
        // 松林 (平台)
        platforms.push({x: 2900, y: 250, w: 120, h: 20, type: 'pine', style: 'litang'});
        // 終點：翰林圖畫院
        platforms.push({x: 3400, y: 450, w: 100, h: 100, type: 'finish'});
    }

    // 監聽鍵盤
    window.addEventListener('keydown', (e) => {
        if (e.code === 'ArrowLeft') keys.left = true;
        if (e.code === 'ArrowRight') keys.right = true;
        if (e.code === 'Space') {
            keys.up = true;
            if (gameState === 'MENU' || gameState === 'GAMEOVER' || gameState === 'WIN') {
               // Prevent accidental restart on space
            } else if (player.grounded) {
                player.vy = player.jumpPower;
                player.grounded = false;
            }
        }
    });

    window.addEventListener('keyup', (e) => {
        if (e.code === 'ArrowLeft') keys.left = false;
        if (e.code === 'ArrowRight') keys.right = false;
        if (e.code === 'Space') keys.up = false;
    });

    function update() {
        if (gameState !== 'PLAYING') return;

        // 物理運算
        if (keys.left) player.vx = -player.speed;
        else if (keys.right) player.vx = player.speed;
        else player.vx *= 0.8; // 摩擦力

        player.vy += player.gravity;
        player.x += player.vx;
        player.y += player.vy;

        player.grounded = false;

        // 平台碰撞檢測
        platforms.forEach(p => {
            if (player.x < p.x + p.w &&
                player.x + player.width > p.x &&
                player.y < p.y + p.h &&
                player.y + player.height > p.y) {
                
                // 碰到致命障礙 (蟹爪枝)
                if (p.type === 'spike') {
                    die();
                    return;
                }
                
                // 碰到隱藏磚塊
                if (p.type === 'secret' && !p.hit && player.vy < 0) {
                     // 從下方撞擊
                     p.hit = true;
                     score += 1000;
                     createParticles(p.x + p.w/2, p.y + p.h, '#gold');
                     alert("發現隱藏彩蛋：樹叢中的「范寬」簽名！(積分+1000)");
                     return;
                }

                // 碰到終點
                if (p.type === 'finish') {
                    win();
                    return;
                }

                // 普通碰撞 (從上方落下)
                if (player.vy > 0 && player.y + player.height - player.vy <= p.y) {
                    player.y = p.y - player.height;
                    player.vy = 0;
                    player.grounded = true;
                } 
                // 從下方撞擊
                else if (player.vy < 0 && player.y - player.vy >= p.y + p.h) {
                    player.y = p.y + p.h;
                    player.vy = 0;
                }
                // 側面碰撞
                else if (player.vx > 0) {
                    player.x = p.x - player.width;
                    player.vx = 0;
                } else if (player.vx < 0) {
                    player.x = p.x + p.w;
                    player.vx = 0;
                }
            }
        });

        // 敵人邏輯 (驢隊)
        enemies.forEach(e => {
            e.x += e.speed;
            if (e.x < e.patrol.min || e.x > e.patrol.max) e.speed *= -1;

            // 碰撞檢測
            if (player.x < e.x + e.w &&
                player.x + player.width > e.x &&
                player.y < e.y + e.h &&
                player.y + player.height > e.y) {
                
                // 踩踏判定
                if (player.vy > 0 && player.y + player.height - player.vy <= e.y + e.h * 0.5) {
                    e.y = 1000; // 移除敵人
                    player.vy = -8; // 反彈
                    score += 100;
                } else {
                    die();
                }
            }
        });

        // 邊界檢查
        if (player.y > 600) die(); // 掉落深淵

        // 更新 UI 區域顯示
        let currentZone = zones.find(z => player.x >= z.start && player.x < z.end);
        if (currentZone) {
            uiZone.innerText = currentZone.name;
        }
        uiScore.innerText = score;

        // 相機跟隨
        if (player.x > 300) {
            cameraX = player.x - 300;
        }
    }

    function draw() {
        // 清除畫布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        ctx.save();
        ctx.translate(-cameraX, 0);

        // 繪製背景細節 (模擬文檔中的畫風)
        drawBackgroundArt();

        // 繪製平台
        platforms.forEach(p => {
            if (p.type === 'secret') {
                if (p.hit) {
                     ctx.fillStyle = '#8B4513';
                     ctx.fillRect(p.x, p.y, p.w, p.h);
                     ctx.fillStyle = 'white';
                     ctx.font = '10px Arial';
                     ctx.fillText("范寬", p.x+5, p.y+25);
                } else {
                    // 隱藏狀態下不可見，或者是樹葉
                    ctx.fillStyle = 'rgba(0,100,0, 0.8)'; // 樹葉顏色
                    ctx.beginPath();
                    ctx.arc(p.x + p.w/2, p.y + p.h/2, 25, 0, Math.PI*2);
                    ctx.fill();
                }
                return;
            }

            if (p.type === 'finish') {
                ctx.fillStyle = '#C0392B';
                ctx.fillRect(p.x, p.y, p.w, p.h);
                ctx.fillStyle = '#fff';
                ctx.fillText("翰林院", p.x + 10, p.y + 50);
                return;
            }

            // 根據不同畫風繪製平台
            if (p.style === 'fankuan') {
                ctx.fillStyle = '#2c2c2c'; // 濃墨
                ctx.fillRect(p.x, p.y, p.w, p.h);
                // 雨點皴效果
                for(let i=0; i<10; i++) {
                    ctx.fillStyle = '#000';
                    ctx.fillRect(p.x + Math.random()*p.w, p.y + Math.random()*p.h, 2, 4);
                }
            } else if (p.style === 'guoxi') {
                ctx.fillStyle = '#7f8c8d'; // 淡墨
                // 卷雲狀
                ctx.beginPath();
                ctx.moveTo(p.x, p.y);
                ctx.quadraticCurveTo(p.x + p.w/2, p.y - 10, p.x + p.w, p.y);
                ctx.lineTo(p.x + p.w, p.y + p.h);
                ctx.lineTo(p.x, p.y + p.h);
                ctx.fill();
            } else if (p.style === 'crabclaw') {
                // 蟹爪枝尖刺
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(p.x + p.w/2, p.y + p.h);
                ctx.lineTo(p.x, p.y);
                ctx.moveTo(p.x + p.w/2, p.y + p.h);
                ctx.lineTo(p.x + p.w, p.y - 10);
                ctx.stroke();
            } else if (p.style === 'axe') {
                // 斧劈皴
                ctx.fillStyle = '#4a6b4a'; // 青綠帶墨
                ctx.beginPath();
                ctx.moveTo(p.x, p.y + p.h);
                ctx.lineTo(p.x + p.w/2, p.y); // 尖頂
                ctx.lineTo(p.x + p.w, p.y + p.h);
                ctx.fill();
                // 皴法線條
                ctx.strokeStyle = '#000';
                ctx.beginPath();
                ctx.moveTo(p.x + 10, p.y + p.h);
                ctx.lineTo(p.x + p.w/2 - 5, p.y + 10);
                ctx.stroke();
            } else if (p.style === 'litang') {
                ctx.fillStyle = '#5c4033'; // 赭石
                ctx.fillRect(p.x, p.y, p.w, p.h);
            } else {
                ctx.fillStyle = '#333';
                ctx.fillRect(p.x, p.y, p.w, p.h);
            }
        });

        // 繪製敵人
        enemies.forEach(e => {
            ctx.fillStyle = '#555';
            ctx.fillRect(e.x, e.y, e.w, e.h);
            // 簡單的驢子形狀
            ctx.fillStyle = '#000';
            ctx.fillRect(e.x-5, e.y-5, 10, 10); // 頭
        });

        // 繪製玩家
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);
        // 畫個官帽
        ctx.fillStyle = '#000';
        ctx.fillRect(player.x - 5, player.y - 5, player.width + 10, 5);
        ctx.fillRect(player.x + 5, player.y - 10, player.width - 10, 5);

        ctx.restore();
    }

    function drawBackgroundArt() {
        // 根據不同區域繪製簡單背景意象
        // 范寬區：垂直長線 (高山)
        if (cameraX < 1200) {
            ctx.fillStyle = 'rgba(0,0,0,0.05)';
            ctx.fillRect(200, 0, 400, 600); // 主山陰影
        }
        // 郭熙區：煙雲
        if (cameraX > 800 && cameraX < 2400) {
            ctx.fillStyle = 'rgba(255,255,255,0.3)';
            ctx.beginPath();
            ctx.arc(1600, 300, 200, 0, Math.PI*2);
            ctx.fill();
        }
        // 李唐區：松林
        if (cameraX > 2000) {
            for(let i=0; i<5; i++) {
                ctx.fillStyle = 'rgba(0,100,0,0.1)';
                ctx.beginPath();
                ctx.moveTo(2500 + i*200, 500);
                ctx.lineTo(2550 + i*200, 300);
                ctx.lineTo(2600 + i*200, 500);
                ctx.fill();
            }
        }
    }

    function die() {
        gameState = 'GAMEOVER';
        msgBox.style.display = 'block';
        document.getElementById('msg-title').innerText = "勝敗乃兵家常事";
        document.getElementById('msg-text').innerText = "你跌入了山谷，或撞上了障礙。\n是否重遊山水？";
    }

    function win() {
        gameState = 'WIN';
        msgBox.style.display = 'block';
        document.getElementById('msg-title').innerText = "抵達翰林畫院";
        document.getElementById('msg-text').innerText = "恭喜！你已領略北宋山水三大家之奧妙。\n最終得分: " + score;
    }

    function startGame() {
        gameState = 'PLAYING';
        msgBox.style.display = 'none';
        initLevel();
    }

    function createParticles(x, y, color) {
        // 簡單粒子效果 (預留)
    }

    function loop() {
        if (gameState === 'PLAYING') {
            update();
            draw();
        } else if (gameState === 'MENU') {
            msgBox.style.display = 'block';
        }
        requestAnimationFrame(loop);
    }

    // 啟動
    loop();

</script>
</body>
</html>
    
  </body>
  
</html>
